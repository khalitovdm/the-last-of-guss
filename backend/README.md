# The Last of Guss - Backend

Бэкенд для браузерной игры, где игроки соревнуются в тапах по виртуальному гусю.

## Требования

- Node.js (версия 16 или выше)
- PostgreSQL (версия 12 или выше)
- npm или yarn

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd the-last-of-guss/backend
```

2. Установите зависимости:
```bash
npm install
```

3. Создайте файл `.env` в корневой директории бэкенда на основе `.env.example`:
```bash
cp env.example .env
```

4. Настройте переменные окружения в файле `.env`:
```env
# Параметры базы данных
DATABASE_URL=postgresql://username:password@localhost:5432/the_last_of_guss

# Параметры JWT
JWT_SECRET=your-secret-key
JWT_EXPIRATION_TIME=24h

# Параметры игры
ROUND_DURATION=60    # Длительность раунда в минутах
COOLDOWN_DURATION=30 # Время ожидания перед началом раунда в секундах
```

## Настройка базы данных

1. Создайте базу данных в PostgreSQL:
```bash
createdb the_last_of_guss
```

2. Запустите миграции:
```bash
npm run migration:run
```

### Дополнительные команды для работы с базой данных

```bash
# Создание новой миграции
npm run migration:generate -- src/migrations/НазваниеМиграции

# Применение миграций
npm run migration:run

# Откат последней миграции
npm run migration:revert
```

## Запуск

### Режим разработки

```bash
# Запуск с автоматической перезагрузкой при изменениях
npm run start:dev
```

### Продакшн режим

```bash
# Сборка проекта
npm run build

# Запуск
npm run start:prod
```

По умолчанию сервер запускается на порту 3000: http://localhost:3000

## API Endpoints

### Аутентификация

- `POST /auth/register` - Регистрация нового пользователя
- `POST /auth/login` - Вход в систему

### Раунды

- `GET /rounds` - Получение списка раундов
- `POST /rounds` - Создание нового раунда (только для админов)
- `GET /rounds/:id` - Получение информации о конкретном раунде
- `POST /rounds/tap` - Тап по гусю
- `GET /rounds/:id/status` - Получение статуса раунда

## Роли пользователей

В игре существует три роли пользователей:

1. **SURVIVOR** - обычный игрок
   - Может тапать по гусю
   - Получает очки за тапы

2. **NIKITA** - особый игрок
   - Может тапать по гусю
   - Не получает очков за тапы
   - Роль назначается автоматически при регистрации с именем "Никита"

3. **ADMIN** - администратор
   - Может создавать раунды
   - Имеет все возможности обычного игрока
   - Роль назначается автоматически при регистрации с именем "admin"

## Правила подсчета очков

- Каждый тап приносит 1 очко
- Каждый 11-й тап приносит 10 очков
- Тапы Никиты не приносят очков
- Тапать можно только в активном раунде

## Масштабирование

Бэкенд разработан с учетом возможности горизонтального масштабирования:

- Нет привязки пользователя к конкретному инстансу
- Используются транзакции для обеспечения консистентности данных
- Можно запускать несколько инстансов за реверс-прокси

## Swagger документация

После запуска сервера, документация API доступна по адресу:
http://localhost:3000/api 